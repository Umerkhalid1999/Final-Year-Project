document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('forgotPasswordForm');
    const emailInput = document.getElementById('email');
    const errorAlert = document.getElementById('errorAlert');

    // Email validation function
    function validateEmail() {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(emailInput.value)) {
            emailInput.classList.add('is-invalid');
            return false;
        }
        emailInput.classList.remove('is-invalid');
        return true;
    }

    // Real-time email validation
    emailInput.addEventListener('input', validateEmail);

    // Form submission
    form.addEventListener('submit', function(e) {
        e.preventDefault();

        // Clear previous messages
        errorAlert.classList.add('d-none');
        errorAlert.textContent = '';
        errorAlert.classList.remove('alert-danger', 'alert-success');

        // Validate email
        if (!validateEmail()) {
            return;
        }

        // Get Firebase auth from the global variable
        const auth = window.firebaseAuth.auth;
        const email = emailInput.value;

        window.firebaseAuth.sendPasswordReset(auth, email)
            .then(() => {
                // Success
                errorAlert.textContent = 'Password reset link sent to your email.';
                errorAlert.classList.remove('d-none');
                errorAlert.classList.add('alert-success');

                // Optional: Redirect after a delay
                setTimeout(() => {
                    window.location.href = "/login";
                }, 2000);
            })
            .catch((error) => {
                // Handle errors
                let errorMessage = 'An error occurred.';
                switch(error.code) {
                    case 'auth/invalid-email':
                        errorMessage = 'Invalid email address.';
                        break;
                    case 'auth/user-not-found':
                        errorMessage = 'No user found with this email address.';
                        break;
                    case 'auth/too-many-requests':
                        errorMessage = 'Too many reset requests. Please try again later.';
                        break;
                }

                errorAlert.textContent = errorMessage;
                errorAlert.classList.remove('d-none');
                errorAlert.classList.add('alert-danger');
            });
    });
});